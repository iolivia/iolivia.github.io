<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/component---src-templates-blog-post-tsx.4693e37b244965d2842d.css">@import url(https://fonts.googleapis.com/css?family=Nunito);@import url(https://use.fontawesome.com/releases/v5.5.0/css/all.css);.blog-post-module--pattern--21yGm{background:repeating-linear-gradient(-45deg,#36c7f3,#36c7f3 10px,#3dcaf5 0,#3dcaf5 20px)}.blog-post-module--separatorBottomDark--3bOfd,.blog-post-module--separatorTopDark--Wpqct{display:block;height:10px;border-top:1px solid rgba(17,17,17,.2);margin:10px 0}.blog-post-module--separatorTopLight--39fTF{display:block;height:10px;border-top:1px solid hsla(0,0%,100%,.2);margin:10px 0}.blog-post-module--separatorBottomLight--340P2{display:block;height:10px;border-bottom:1px solid hsla(0,0%,100%,.2);margin-bottom:10px}.blog-post-module--contentContainer--1x_eD{padding:15px}.blog-post-module--postContainer--ggIbM img{width:100%}.blog-post-module--postContainer--ggIbM h1,.blog-post-module--postContainer--ggIbM h2,.blog-post-module--postContainer--ggIbM h3{margin-top:25px}.blog-post-module--postTitle--3IOzu{text-align:center}.blog-post-module--postTitle--3IOzu h1{margin:15px 0}.blog-post-module--postMetadata--1y-Hj{display:flex;justify-content:space-between}.blog-post-module--postMetadata--1y-Hj a{color:#36c7f3}.blog-post-module--postMetadata--1y-Hj a:hover{color:#474747}.blog-post-module--author--1ftr1{flex-grow:1}.blog-post-module--postContent--38jG5,.blog-post-module--postContent--38jG5 p{text-align:left;line-height:35px;font-size:21px}.blog-post-module--postContent--38jG5 pre{font-size:15px}ul.blog-post-module--tagsList--2q3wX{list-style-type:none}ul.blog-post-module--tagsList--2q3wX li{display:inline-block}.Page-module--pattern--2OMjD{background:repeating-linear-gradient(-45deg,#36c7f3,#36c7f3 10px,#3dcaf5 0,#3dcaf5 20px)}.Page-module--separatorBottomDark--3Z-pL,.Page-module--separatorTopDark--1PJCx{display:block;height:10px;border-top:1px solid rgba(17,17,17,.2);margin:10px 0}.Page-module--separatorTopLight--18HRW{display:block;height:10px;border-top:1px solid hsla(0,0%,100%,.2);margin:10px 0}.Page-module--separatorBottomLight--12LAs{display:block;height:10px;border-bottom:1px solid hsla(0,0%,100%,.2);margin-bottom:10px}.Page-module--pageInnerContainer--3yRDU{margin-left:calc(25% + 100px);margin-right:50px}@media only screen and (max-width:1026px){.Page-module--pageInnerContainer--3yRDU{margin:0 auto}}.Banner-module--pattern--30-Rm{background:repeating-linear-gradient(-45deg,#36c7f3,#36c7f3 10px,#3dcaf5 0,#3dcaf5 20px)}.Banner-module--separatorBottomDark--1VDp2,.Banner-module--separatorTopDark--1c1VX{display:block;height:10px;border-top:1px solid rgba(17,17,17,.2);margin:10px 0}.Banner-module--separatorTopLight--2hymc{display:block;height:10px;border-top:1px solid hsla(0,0%,100%,.2);margin:10px 0}.Banner-module--separatorBottomLight--1HHq1{display:block;height:10px;border-bottom:1px solid hsla(0,0%,100%,.2);margin-bottom:10px}.Banner-module--bannerContainer--2kfC_{width:25%;min-width:250px;padding:25px;display:flex;flex-direction:column;min-height:100vh;position:fixed}@media only screen and (max-width:1026px){.Banner-module--bannerContainer--2kfC_{display:none}}.Footer-module--pattern--7s7q6{background:repeating-linear-gradient(-45deg,#36c7f3,#36c7f3 10px,#3dcaf5 0,#3dcaf5 20px)}.Footer-module--separatorBottomDark--1nsn2,.Footer-module--separatorTopDark--2PN15{display:block;height:10px;border-top:1px solid rgba(17,17,17,.2);margin:10px 0}.Footer-module--separatorTopLight--2adox{display:block;height:10px;border-top:1px solid hsla(0,0%,100%,.2);margin:10px 0}.Footer-module--separatorBottomLight--278Mg{display:block;height:10px;border-bottom:1px solid hsla(0,0%,100%,.2);margin-bottom:10px}.Footer-module--footerContainer--6amLz{background-color:#36c7f3;display:block}.Footer-module--footerContainer--6amLz a{color:#474747}.Footer-module--footerContainer--6amLz a:hover{color:#fff}.Footer-module--footerInnerContainer--3s6kB{display:flex;justify-content:space-between;padding-top:10px}.Footer-module--footerSocialIconsItem--3ocE0{display:inline;margin-left:10px}.Header-module--pattern--2EFLT{background:repeating-linear-gradient(-45deg,#36c7f3,#36c7f3 10px,#3dcaf5 0,#3dcaf5 20px)}.Header-module--separatorBottomDark--1NXeZ,.Header-module--separatorTopDark--1etmK{display:block;height:10px;border-top:1px solid rgba(17,17,17,.2);margin:10px 0}.Header-module--separatorTopLight--2v-vk{display:block;height:10px;border-top:1px solid hsla(0,0%,100%,.2);margin:10px 0}.Header-module--separatorBottomLight--2MHyW{display:block;height:10px;border-bottom:1px solid hsla(0,0%,100%,.2);margin-bottom:10px}p{margin:20px 0;line-height:1.7em}*{margin:0}a{text-decoration:none;color:#36c7f3}a:hover{color:#279abd}body{font-size:14px;font-weight:400;line-height:20px;color:#474747}body,h1,h2,h3,h4,h5,h6{font-family:Nunito;font-style:normal;font-variant:normal}h1,h2,h3,h4,h5,h6{font-weight:700}h1{font-size:26px;line-height:26px}h2{font-size:23px;line-height:23px}h3{font-size:20px;line-height:20px}h4{font-size:18px;line-height:18px}h5{font-size:17px;line-height:17px}h6{font-size:15px;line-height:15px}p{font-size:14px;line-height:20px}blockquote,p{font-family:Nunito;font-style:normal;font-variant:normal;font-weight:400}blockquote{font-size:21px;line-height:30px}pre{font-family:Nunito;font-size:13px;font-style:normal;font-variant:normal;font-weight:400;line-height:18.5714px}.Header-module--headerContainer--1T6Fd{flex-grow:0.8;text-align:center;margin-top:100px}.Header-module--headerContainer--1T6Fd ul{list-style-type:none;margin:0;padding:0}.Header-module--headerContainer--1T6Fd a{color:#474747}.Header-module--headerContainer--1T6Fd a:hover{color:#fff}a.Header-module--headerLogo--2Nsjr{display:block;padding:10px}a.Header-module--headerLogo--2Nsjr h1{font-size:35px}a.Header-module--headerLogo--2Nsjr:hover{color:#fff}.Header-module--headerInfo--jqeNh h4{margin-bottom:10px}</style><style data-href="/app.b6f197430f783b3e67aa.css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.0.55"/><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-26280927-2', 'auto', {});
      
      }
      </script><title data-react-helmet="true">Implementing a Bloom filter - Part 3</title><meta data-react-helmet="true" name="description" content="Last time we looked at how the internals of Bloom filters work. In this post, we&#x27;ll get our hands dirty and implement it.  We&#x27;ll set up anâ€¦"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-b21fbdbad5d0c58e75ff.js"/><link as="script" rel="preload" href="/app-289e6c7c83368adb5b1b.js"/><link as="script" rel="preload" href="/0-85c5a326c0f59adafd80.js"/><link as="script" rel="preload" href="/1-078f37b172f0c8d815c4.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-tsx-96a24fd88e7ebf21f19b.js"/><link rel="preload" href="/static/d/398/path---posts-4-bloom-filter-part-3-653-843-G1tHl4XbvwoX67YTm5TowTdQo.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div><div class="Banner-module--bannerContainer--2kfC_ Banner-module--pattern--30-Rm"><header class="Header-module--headerContainer--1T6Fd"><div><div><a class="Header-module--headerLogo--2Nsjr" href="/"><h1><div><span style="display:inline-block;width:auto"><span class="initial_textAnim_fadeIn_80003">o</span></span><span style="display:inline-block;width:auto"><span class="initial_textAnim_fadeIn_80003">l</span></span><span style="display:inline-block;width:auto"><span class="initial_textAnim_fadeIn_80003">i</span></span><span style="display:inline-block;width:auto"><span class="initial_textAnim_fadeIn_80003">v</span></span><span style="display:inline-block;width:auto"><span class="initial_textAnim_fadeIn_80003">i</span></span><span style="display:inline-block;width:auto"><span class="initial_textAnim_fadeIn_80003">a</span></span><span style="display:inline-block;width:0.5em"><span class="initial_textAnim_fadeIn_80003"> </span></span><span style="display:inline-block;width:auto"><span class="initial_textAnim_fadeIn_80003">i</span></span><span style="display:inline-block;width:auto"><span class="initial_textAnim_fadeIn_80003">f</span></span><span style="display:inline-block;width:auto"><span class="initial_textAnim_fadeIn_80003">r</span></span><span style="display:inline-block;width:auto"><span class="initial_textAnim_fadeIn_80003">i</span></span><span style="display:inline-block;width:auto"><span class="initial_textAnim_fadeIn_80003">m</span></span></div></h1></a><div class="Header-module--separatorBottomLight--2MHyW"></div><div class="Header-module--headerInfo--jqeNh"><h4> <!-- -->Software Engineer<!-- --> </h4><p> <!-- -->  </p><div class="Header-module--separatorBottomLight--2MHyW"></div><a href="mailto:olivia_github@outlook.com"><p>olivia_github@outlook.com</p></a><div class="Header-module--separatorBottomLight--2MHyW"></div></div></div></div></header><footer class="Footer-module--footerContainer--6amLz Footer-module--pattern--7s7q6"><div class="Footer-module--separatorBottomLight--278Mg"></div><div class="Footer-module--footerInnerContainer--3s6kB undefined"><div>Copyright 2018</div><ul><li class="Footer-module--footerSocialIconsItem--3ocE0"><a href="https://www.linkedin.com/in/oliviaifrim/" title="linkedin" target="_blank"><i class="fab fa-linkedin fa-lg"></i></a></li><li class="Footer-module--footerSocialIconsItem--3ocE0"><a href="https://github.com/iolivia" title="github" target="_blank"><i class="fab fa-github fa-lg"></i></a></li><li class="Footer-module--footerSocialIconsItem--3ocE0"><a href="https://www.quora.com/profile/Olivia-Ifrim" title="quora" target="_blank"><i class="fab fa-quora fa-lg"></i></a></li></ul></div></footer></div><div class="Page-module--pageInnerContainer--3yRDU"><div></div><div class="blog-post-module--contentContainer--1x_eD"><div class="blog-post-module--postContainer--ggIbM"><div><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:42.857142857142854%"></div><img src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQCAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAAEAgP/2gAMAwEAAhADEAAAARleQ6zigTn/AP/EABsQAAIBBQAAAAAAAAAAAAAAAAIDIgARM0FD/9oACAEBAAEFAlxoiuJnLltuX//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPwGMf//EABgRAAMBAQAAAAAAAAAAAAAAAAABEQIh/9oACAECAQE/Ad2iXD//xAAbEAAABwEAAAAAAAAAAAAAAAAAAQIQERIhcf/aAAgBAQAGPwK+FLYUBLK6P//EABwQAAICAgMAAAAAAAAAAAAAAAABESFRsRAxgf/aAAgBAQABPyHKQilR2UCcZos+Rs3oWvBf/9oADAMBAAIAAwAAABAIH//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQMBAT8QmQej/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAgEBPxBtKKg//8QAHBABAAICAwEAAAAAAAAAAAAAAQARMUEhYfCh/9oACAEBAAE/ELsYSOwtN9wC5Ry02RKaY0l4dzydzL7mfQn/2Q==" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition:opacity 0.5s;transition-delay:0.25s"/><noscript><picture><source srcSet="/static/4836718e198b6a8cdbecc763fb6384a3/cb2d9/bloom-flower-3.jpg 175w,
/static/4836718e198b6a8cdbecc763fb6384a3/7e73d/bloom-flower-3.jpg 350w,
/static/4836718e198b6a8cdbecc763fb6384a3/81388/bloom-flower-3.jpg 688w" sizes="(max-width: 688px) 100vw, 688px" /><img src="/static/4836718e198b6a8cdbecc763fb6384a3/81388/bloom-flower-3.jpg" alt="" style="position:absolute;top:0;left:0;transition:opacity 0.5s;transition-delay:0.5s;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></div><div class="blog-post-module--postTitle--3IOzu"><div class="blog-post-module--separatorTopDark--Wpqct"></div><h1>Implementing a Bloom filter - Part 3</h1><div class="blog-post-module--separatorBottomDark--3bOfd"></div></div><div class="blog-post-module--postMetadata--1y-Hj"><div class="blog-post-module--author--1ftr1">by <a href="/">olivia ifrim</a> on <!-- -->May 24, 2017</div><div><ul class="blog-post-module--tagsList--2q3wX"><li>Â <!-- --> â€¢<!-- -->Â <!-- -->bloom filter</li><li>Â <!-- --> â€¢<!-- -->Â <!-- -->bloom</li><li>Â <!-- --> â€¢<!-- -->Â <!-- -->cpp</li><li>Â <!-- --> â€¢<!-- -->Â <!-- -->c++</li></ul></div></div><div class="blog-post-module--separatorBottomDark--3bOfd"></div><div class="blog-post-module--postContent--38jG5"><div><p>Last time we looked at how the internals of Bloom filters work. In this post, we'll get our hands dirty and implement it. </p>
<p>We'll set up an interface with pure virtuals. </p>
<div class="gatsby-highlight" data-language="cpp"><pre class="language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">IBloomFilter</span> 
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string input<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">isMaybePresent</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string input<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Now we'll need to pick something to use as our array of bits. The two obvious choices are <a href="http://www.cplusplus.com/reference/bitset/bitset/"><code class="language-text">std::bitset</code></a> and <a href="http://www.cplusplus.com/reference/vector/vector-bool/"><code class="language-text">std::vector&lt;bool&gt;</code></a>. Since we want the user of the Bloom filter to specify its size at construction time, we will need to go with the vector. </p>
<p>Here is our class definition. </p>
<div class="gatsby-highlight" data-language="cpp"><pre class="language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">BloomFilter</span> <span class="token operator">:</span> <span class="token keyword">public</span> IBloomFilter <span class="token punctuation">{</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">BloomFilter</span><span class="token punctuation">(</span><span class="token keyword">const</span> Hash<span class="token operator">&amp;</span> hash<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Inherited via IBloomFilter</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string input<span class="token punctuation">)</span> override<span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">isMaybePresent</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string input<span class="token punctuation">)</span> <span class="token keyword">const</span> override<span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    Hash m_hash<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_k<span class="token punctuation">;</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> m_vector<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Now, you might be asking how we will pick <code class="language-text">k</code> hashing functions. What we actually need is <code class="language-text">k</code> functions which will somehow hash the input, give us <code class="language-text">k</code> different indexes into our bit vector and ensure that these results are consistent. </p>
<p>But, how can we pick <code class="language-text">k</code> different ways of hashing? There are only a fixed number of <a href="https://en.wikipedia.org/wiki/List_of_hash_functions">hashing algorithms</a>, and in theory our <code class="language-text">k</code> could be anything. Luckily, there is a way of generating a different hash based on the iteration number, this technique is called <a href="https://en.wikipedia.org/wiki/Double_hashing">double hashing</a>. Let's see how this works. </p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">h(input, iteration) = h1(input) + iteration * h2(input)</code></pre></div>
<p>So all we have to do is pick 2 different hashing functions, and for every iteration compute the final hash using the formula above. </p>
<p>We will use <a href="https://github.com/aappleby/smhasher">Murmur Hash</a> for generating the two unique hashes.</p>
<div class="gatsby-highlight" data-language="cpp"><pre class="language-cpp"><code class="language-cpp">std<span class="token operator">::</span>array<span class="token operator">&lt;</span><span class="token keyword">uint32_t</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">></span> Hash<span class="token operator">::</span><span class="token function">hash</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string <span class="token operator">&amp;</span> input<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>array<span class="token operator">&lt;</span><span class="token keyword">uint32_t</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">></span> out<span class="token punctuation">;</span>
    <span class="token function">MurmurHash3_x86_32</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> out<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>And now we just apply the forumula for every iteration. We also modulo with the size of our filter to make sure the numbers we get are actually in our Bloom filter range.</p>
<div class="gatsby-highlight" data-language="cpp"><pre class="language-cpp"><code class="language-cpp">std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">uint32_t</span><span class="token operator">></span> Hash<span class="token operator">::</span><span class="token function">hash</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> input<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> iterations<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> max<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">auto</span> hashesIndexed <span class="token operator">=</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">uint32_t</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> hashedInput <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">hash</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> firstHash <span class="token operator">=</span> hashedInput<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> secondHash <span class="token operator">=</span> hashedInput<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> iterations<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> hashedInputInt <span class="token operator">=</span> <span class="token punctuation">(</span>firstHash <span class="token operator">+</span> secondHash <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">%</span> max<span class="token punctuation">;</span>
        hashesIndexed<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>hashedInputInt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> hashesIndexed<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now that we have all the moving parts, we can easily implement <code class="language-text">put</code> and <code class="language-text">isMaybePresent</code>.</p>
<div class="gatsby-highlight" data-language="cpp"><pre class="language-cpp"><code class="language-cpp"><span class="token keyword">void</span> BloomFilter<span class="token operator">::</span><span class="token function">put</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string input<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Hash and get k indexes</span>
    <span class="token keyword">auto</span><span class="token operator">&amp;</span> indexes <span class="token operator">=</span> m_hash<span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> m_k<span class="token punctuation">,</span> m_vector<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Set all those bits to 1</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> index <span class="token operator">:</span> indexes<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        m_vector<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> BloomFilter<span class="token operator">::</span><span class="token function">isMaybePresent</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string input<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Hash and get k indexes</span>
    <span class="token keyword">auto</span><span class="token operator">&amp;</span> indexes <span class="token operator">=</span> m_hash<span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> m_k<span class="token punctuation">,</span> m_vector<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Find if all bits are set</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> index <span class="token operator">:</span> indexes<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_vector<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>And this is pretty much it. You can see the full code at <a href="https://github.com/iolivia/bloom-filter">iolivia/bloom-filter</a>. Next up we'll do some experiments with <code class="language-text">n</code> and <code class="language-text">k</code> and see what our error rates are.</p></div></div><div id="disqus_thread"></div></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-tsx","jsonName":"posts-4-bloom-filter-part-3-653","path":"/posts/4-bloom-filter-part-3/"};window.dataPath="398/path---posts-4-bloom-filter-part-3-653-843-G1tHl4XbvwoX67YTm5TowTdQo";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.b6f197430f783b3e67aa.css","/app-289e6c7c83368adb5b1b.js"],"component---src-templates-blog-post-tsx":["/component---src-templates-blog-post-tsx.4693e37b244965d2842d.css","/component---src-templates-blog-post-tsx-96a24fd88e7ebf21f19b.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx.d777b3883a33667a36bc.css","/component---src-pages-404-tsx-6fbb67e968f2ca1fd5bf.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx.796e7821ee5d5fbaa845.css","/component---src-pages-index-tsx-3f44109062cd83cb1f02.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-tsx-96a24fd88e7ebf21f19b.js" async=""></script><script src="/1-078f37b172f0c8d815c4.js" async=""></script><script src="/0-85c5a326c0f59adafd80.js" async=""></script><script src="/app-289e6c7c83368adb5b1b.js" async=""></script><script src="/webpack-runtime-b21fbdbad5d0c58e75ff.js" async=""></script></body></html>
{"data":{"site":{"siteMetadata":{"fullName":"olivia ifrim","settings":{"disqusShortName":"oliviaifrim","disqusEnabled":false},"twitterHandle":"@oliviff"}},"markdownRemark":{"id":"2f3e65e5-ae43-5892-9ee6-c439db7c63ec","html":"<p><a href=\"/posts/design-patterns/\">Previously</a> we discussed design patterns briefly and why you might want to use them, so today we'll continue that journey and look into our first design pattern: the decorator pattern. In this post you are going to learn:</p>\n<ul>\n<li>what is the decorator pattern</li>\n<li>a simple example on how to use them</li>\n<li>a more advanced example</li>\n<li>advantages and disadvantages of the decorator pattern</li>\n</ul>\n<h2>Decorator pattern</h2>\n<p>The decorator pattern is a structural design pattern that allows you to extend the behaviour of an existing class by wrapping it. It's called a decorator because you are decorating the functionality of the initial class.</p>\n<h2>Ciphers</h2>\n<p>Let's take a specific example with ciphers. A <a href=\"https://en.wikipedia.org/wiki/Cipher\">cipher</a> is a simple algorithm to take some data and encrypt it according to some rules. For example, we might give it \"abc\" and it might give us back \"igb\".</p>\n<h3>Caesar cipher</h3>\n<p>A <a href=\"https://en.wikipedia.org/wiki/Caesar_cipher\">Caesar cipher</a> is a simple cipher algorithm originating from the Roman times (hence the name) that basically shifts every letter by a given amount to the right, therefore replacing it with a new letter. For example, in a Caesar cipher with an offset of 3, A becomes D, B becomes E, and so on. </p>\n<p>Here are a few examples.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token comment\">// A Caesar cipher with an offset of 3</span>\n<span class=\"token string\">\"a\"</span> <span class=\"token punctuation\">-></span> <span class=\"token string\">\"d\"</span> <span class=\"token comment\">// a is the 1st letter in the alphabet, so we need the 1+3=4th letter which is d</span>\n<span class=\"token string\">\"A\"</span> <span class=\"token punctuation\">-></span> <span class=\"token string\">\"D\"</span> <span class=\"token comment\">// A is the 1st letter (uppercase), so we need the 4th (uppercase) which is D </span>\n<span class=\"token string\">\"123\"</span> <span class=\"token punctuation\">-></span> <span class=\"token string\">\"123\"</span> <span class=\"token comment\">// numbers are kept as is (un-encrypted)</span>\n<span class=\"token string\">\"123a\"</span> <span class=\"token punctuation\">-></span> <span class=\"token string\">\"123d\"</span> <span class=\"token comment\">// if we have a combination of letters and numbers, the numbers are kept as is and the letters are encrypted</span>\n<span class=\"token string\">\"abc\"</span> <span class=\"token punctuation\">-></span> <span class=\"token string\">\"def\"</span> <span class=\"token comment\">// we shift every letter 3 spaces so a->d, b->e, c->f, so the whole thing is def</span>\n<span class=\"token string\">\"hello\"</span> <span class=\"token punctuation\">-></span> <span class=\"token string\">\"khoor\"</span> <span class=\"token comment\">// we translate every letter to its lowercase equivalent</span>\n<span class=\"token string\">\"Hello\"</span> <span class=\"token punctuation\">-></span> <span class=\"token string\">\"Khoor\"</span> <span class=\"token comment\">// H is now uppercase, so notice how the K is also now uppercase</span>\n<span class=\"token string\">\"Hello world\"</span> <span class=\"token punctuation\">-></span> <span class=\"token string\">\"Hhoor zruog\"</span> <span class=\"token comment\">// The space is kept as is (the same for all non-alphabetical symbols)</span>\n\n<span class=\"token comment\">// A Caesar cipher with an offset of 7</span>\n<span class=\"token string\">\"a\"</span> <span class=\"token punctuation\">-></span> <span class=\"token string\">\"h\"</span> <span class=\"token comment\">// same thing as we did above, except now we shift everything by 7, so we need 1+7=8th letter which is h</span>\n<span class=\"token string\">\"hello\"</span> <span class=\"token punctuation\">-></span> <span class=\"token string\">\"olssv\"</span> <span class=\"token comment\">// we again shift by 7, so notice how the answer is different from the cipher above</span></code></pre></div>\n<p>So in the version of the Caesar cipher we are going to implement:</p>\n<ul>\n<li>digits are kept as is (see <code class=\"language-text\">&quot;123&quot; -&gt; &quot;123&quot;</code>)</li>\n<li>symbols are kept as is (see <code class=\"language-text\">&quot;Hello world&quot; -&gt; &quot;Hhoor zruog&quot;</code>)</li>\n<li>case sensitive (see <code class=\"language-text\">&quot;hello&quot; -&gt; &quot;khoor&quot;</code> and <code class=\"language-text\">&quot;Hello world&quot; -&gt; &quot;Hhoor zruog&quot;</code>)</li>\n</ul>\n<p>Great, so let's talk about how we might implement that. We need to receive the plaintext string as an input, along with the offset. Then for every character in the plaintext:</p>\n<ul>\n<li>add it as is if it's a digit or a symbol (in other words, if it's not an alpha character)</li>\n<li>if it's lowercase, shift it by the offset and make sure to stay in the lowercase range</li>\n<li>if it's uppercase, shift it by the offset and make sure to stay in the uppercase range</li>\n</ul>\n<p>The implementation is not too complex, the only tricky bit is making sure to stay in range. Here is the code in rust. </p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token comment\">// We define a function which takes the input string and the offset</span>\n<span class=\"token comment\">// and returns the encrypted string.</span>\n<span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt_caesar</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span> offset<span class=\"token punctuation\">:</span> u32<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Create a new string, this will be our result.</span>\n  <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> encrypted_data <span class=\"token operator\">=</span> String<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Find the range limits for uppercase and lowercase letters</span>\n  <span class=\"token comment\">// This is just the ASCII value of each character</span>\n  <span class=\"token keyword\">let</span> uppercase_start <span class=\"token operator\">=</span> <span class=\"token char string\">'A'</span> <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> lowercase_start <span class=\"token operator\">=</span> <span class=\"token char string\">'a'</span> <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// For each character in the input string</span>\n  <span class=\"token keyword\">for</span> character <span class=\"token keyword\">in</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">chars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> encrypted_character<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// If it's not a letter, we just keep it as is</span>\n    <span class=\"token keyword\">if</span> <span class=\"token operator\">!</span>character<span class=\"token punctuation\">.</span><span class=\"token function\">is_alphabetic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        encrypted_data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>character<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// If it's an uppercase letter, shift by the offset and make sure</span>\n      <span class=\"token comment\">// we keep it in the uppercase range (that's what the modulo 26 is for)</span>\n      <span class=\"token keyword\">if</span> character<span class=\"token punctuation\">.</span><span class=\"token function\">is_uppercase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        encrypted_character <span class=\"token operator\">=</span>\n            <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>character <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> offset <span class=\"token operator\">-</span> uppercase_start<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">26</span> <span class=\"token operator\">+</span> uppercase_start<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// If it's an lowercase letter, shift by the offset and make sure</span>\n      <span class=\"token comment\">// we keep it in the lowercase range (that's what the modulo 26 is for)</span>\n        encrypted_character <span class=\"token operator\">=</span>\n            <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>character <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> offset <span class=\"token operator\">-</span> lowercase_start<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">26</span> <span class=\"token operator\">+</span> lowercase_start<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">// Add the encrypted character to the encrypted string</span>\n      encrypted_data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>std<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>char<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">from_u32</span><span class=\"token punctuation\">(</span>encrypted_character<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Now we have filled up our encrypted string, so we just return it.</span>\n  <span class=\"token keyword\">return</span> encrypted_data<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Great, now we have an implementation. If we run this code we'll get something like this. Notice the results are correct: the offsets are correct (and different for 3 and 7), symbols and digits are kept as is and our algorithm is case-sensitive. 👍✅</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token function\">encrypt_caesar</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n<span class=\"token string\">\"khoor\"</span>\n\n<span class=\"token function\">encrypt_caesar</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span>\n<span class=\"token string\">\"olssv\"</span>\n\n<span class=\"token function\">encrypt_caesar</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span>\n<span class=\"token string\">\"Olssv\"</span>\n\n<span class=\"token function\">encrypt_caesar</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"123 abc\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n<span class=\"token string\">\"123 def\"</span></code></pre></div>\n<h3>Rot13 cipher</h3>\n<p>Another popular cipher is the Rot13 cipher which basically shifts every letter by 13 characters. But wait, that sounds kind of familiar. Isn't that like a Caesar cipher, just with an offset of 13? Well that is exactly right. </p>\n<p>Let's implement it (the bad way first).</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token comment\">// We define another function, which also takes a string (but no offset this time)</span>\n<span class=\"token comment\">// and returs the encrypted string.</span>\n<span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt_rot13</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Hardcode the offset to 13</span>\n  <span class=\"token keyword\">let</span> offset <span class=\"token operator\">=</span> <span class=\"token number\">13</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Pretty much the same code as before</span>\n  <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> encrypted_data <span class=\"token operator\">=</span> String<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> uppercase_start <span class=\"token operator\">=</span> <span class=\"token char string\">'A'</span> <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> lowercase_start <span class=\"token operator\">=</span> <span class=\"token char string\">'a'</span> <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> character <span class=\"token keyword\">in</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">chars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> encrypted_character<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token operator\">!</span>character<span class=\"token punctuation\">.</span><span class=\"token function\">is_alphabetic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        encrypted_data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>character<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> character<span class=\"token punctuation\">.</span><span class=\"token function\">is_uppercase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        encrypted_character <span class=\"token operator\">=</span>\n            <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>character <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> offset <span class=\"token operator\">-</span> uppercase_start<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">26</span> <span class=\"token operator\">+</span> uppercase_start<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        encrypted_character <span class=\"token operator\">=</span>\n            <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>character <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> offset <span class=\"token operator\">-</span> lowercase_start<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">26</span> <span class=\"token operator\">+</span> lowercase_start<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      encrypted_data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>std<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>char<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">from_u32</span><span class=\"token punctuation\">(</span>encrypted_character<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> encrypted_data<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The differences of this implementation to the Caesar cipher are:</p>\n<ul>\n<li>the name of the function (<code class=\"language-text\">encrypt_rot13</code> vs <code class=\"language-text\">encrypt_caesar</code>)</li>\n<li>no offset parameter</li>\n<li>harcoding <code class=\"language-text\">13</code> as the offset</li>\n<li>copy-paste of the other code for the encryption part</li>\n</ul>\n<p>This feels really wrong though. We are duplicating a lot of this code. If someone makes a bug-fix to the Caesar cipher implementation our function will still use the copy paste version, so we will never get the fix. Is there a way we can reuse this? Let's try.</p>\n<h2>DRY - Do not repeat yourself</h2>\n<p>The biggest problem with the previous implementation was that we were duplicating about 90% of the code. Here is a slightly better version.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token comment\">// Same function definition as above</span>\n<span class=\"token comment\">// Input string -> output encrypted string</span>\n<span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt_rot13</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Let's simply call our caesar function with the</span>\n  <span class=\"token comment\">// input string and an offset of 13. </span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">encrypt_caesar</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token number\">13</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ok this is much better:</p>\n<ul>\n<li>we are reusing the caesar function (so we'll get any future updates)</li>\n<li>we are passing the offset as a parameter (which is much better than baking it into the function implementation)</li>\n<li>no more copy-paste</li>\n</ul>\n<p>Now our code looks like this on a high level. </p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt_caesar</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span> offset<span class=\"token punctuation\">:</span> u32<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// [...] </span>\n  <span class=\"token comment\">// omitting the implementation here but it's the same as before</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt_rot13</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// [...] </span>\n  <span class=\"token comment\">// omitting the implementation here but it's the same as before</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>So we have two functions with different names, different input params. If we wanted to add a new cipher it would look kind of like this. </p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt_caesar</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span> offset<span class=\"token punctuation\">:</span> u32<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// [...] </span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt_rot13</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// [...] </span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt_my_other_cipher</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span> some other parameters<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// [...] </span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>A new function, with a new name and an arbitrary number of new parameters. This feels a bit wrong, because all these functions conceptually do the same thing: they take an input string and they return an encrypted version of that string according to some pre-established rules. Shouldn't they be a bit more consistent? Well, they could. Here's an even better version. </p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token comment\">// Common interface which all ciphers must implement</span>\n<span class=\"token keyword\">trait</span> Cipher <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Caesar cipher</span>\n<span class=\"token keyword\">struct</span> CaesarCipher <span class=\"token punctuation\">{</span>\n    offset<span class=\"token punctuation\">:</span> u32<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">impl</span> Cipher <span class=\"token keyword\">for</span> CaesarCipher <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n      <span class=\"token punctuation\">...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Rot13 cipher</span>\n<span class=\"token keyword\">struct</span> Rot13Cipher <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">impl</span> Cipher <span class=\"token keyword\">for</span> Rot13Cipher <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n      <span class=\"token punctuation\">...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>So what did we do here? We created an interface which all ciphers must obey (which is exactly the requirement I mentioned above: input string -> output encrypted string). We created two classes: <code class=\"language-text\">CaesarCipher</code> and <code class=\"language-text\">Rot13Cipher</code> which implement this interface (and have largely the same implementation they did before). Notice how none of the functionality actually changed, all our tests still pass, the code behaves the same way, the only difference is in the form of the code. Now we have nice classes and shared interfaces which we can easily extend. Now creating a new cipher looks like this, which feels like cleaner.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">struct</span> NewCipher <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// new parameters here</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">impl</span> Cipher <span class=\"token keyword\">for</span> NewCipher <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// new implementation here</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now let's look a bit closer at the implementation of the Rot13 cipher. </p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">impl</span> Cipher <span class=\"token keyword\">for</span> Rot13Cipher <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> caesar_cypher <span class=\"token operator\">=</span> CaesarCipher <span class=\"token punctuation\">{</span> offset<span class=\"token punctuation\">:</span> <span class=\"token number\">13</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> encrypted_data <span class=\"token operator\">=</span> caesar_cypher<span class=\"token punctuation\">.</span><span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> encrypted_data<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>What are we doing here? We are creating a new instance of a Caesar cipher with an offset of 13 and we are simply using that to encrypt the data and return. This is a very simple version of the decorator pattern where we are essentially wrapping the functionality of a caesar cipher with a specific offset. Now, this is not 100% augmenting the existing functionality, it's more using a specific version of it. </p>\n<p>So let's say we wanted to create a new cipher which:</p>\n<ul>\n<li>starts by adding 10 characters of garbage at the beginning of the output</li>\n<li>encrypts using rot13 cipher</li>\n<li>adds another 10 characters of garbage at the end </li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">struct</span> GarbageCipher <span class=\"token punctuation\">{</span>\n    how_much_garbage<span class=\"token punctuation\">:</span> u32<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">impl</span> Cipher <span class=\"token keyword\">for</span> GarbageCipher <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fn</span> <span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> encrypted_data <span class=\"token operator\">=</span> String<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Add the garbage at the start</span>\n        encrypted_data<span class=\"token punctuation\">.</span><span class=\"token function\">push_str</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token function\">get_random_garbage</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>how_much_garbage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Encrypt using rot13</span>\n        <span class=\"token keyword\">let</span> rot13_cypher <span class=\"token operator\">=</span> Rot13Cipher <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        encrypted_data<span class=\"token punctuation\">.</span><span class=\"token function\">push_str</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>rot13_cypher<span class=\"token punctuation\">.</span><span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Add the garbage at the end</span>\n        encrypted_data<span class=\"token punctuation\">.</span><span class=\"token function\">push_str</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token function\">get_random_garbage</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>how_much_garbage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> encrypted_data<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And now for a dummy implementation of generating garbage that just generates <code class=\"language-text\">aaaa</code> n times, here is what we get. </p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token attribute attr-name\">#[test]</span>\n<span class=\"token keyword\">fn</span> <span class=\"token function\">garbage_cypher</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> garbage_cypher <span class=\"token operator\">=</span> GarbageCipher <span class=\"token punctuation\">{</span>\n      how_much_garbage<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> tests <span class=\"token operator\">=</span> Vec<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"Why did the chicken cross the road?\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"aaaaaaaaaaJul qvq gur puvpxra pebff gur ebnq?aaaaaaaaaa\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> test <span class=\"token keyword\">in</span> tests <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">run_cypher_test</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>garbage_cypher<span class=\"token punctuation\">,</span> test<span class=\"token number\">.0</span><span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> test<span class=\"token number\">.1</span><span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">GarbageCipher</code> implementation is decorating the functionality of <code class=\"language-text\">Rot13Cipher</code> by doing its thing, which incidentally happens to be adding garbage at the beginning and at the end. </p>\n<p>And that, in short, is the decorator pattern. </p>\n<p>Have you used the decorator pattern recently? Have you thought of a usecase now that you've read this post? Let me know!</p>","excerpt":"Previously  we discussed design patterns briefly and why you might want to use them, so today we'll continue that journey and look into our…","frontmatter":{"title":"Decorator pattern with ciphers","date":"January 05, 2019","tags":["design patterns","design","decorator pattern"],"featuredImage":{"childImageSharp":{"sizes":{"src":"/static/65c5f5d8af655ae04ffdd988a4417846/5aa81/decorator.jpg","srcSet":"/static/65c5f5d8af655ae04ffdd988a4417846/25db0/decorator.jpg 175w,\n/static/65c5f5d8af655ae04ffdd988a4417846/62b24/decorator.jpg 350w,\n/static/65c5f5d8af655ae04ffdd988a4417846/5aa81/decorator.jpg 700w","base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAD/9oADAMBAAIQAxAAAAHHpJqyYUP/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAXEAEBAQEAAAAAAAAAAAAAAAAAAREQ/9oACAEBAAE/IYi81r//2gAMAwEAAgADAAAAEDQf/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/ELGP/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EJWv/8QAGBABAQEBAQAAAAAAAAAAAAAAAQARITH/2gAIAQEAAT8Q9wMgbDjDye7/2Q==","aspectRatio":2.3333333333333335,"sizes":"(max-width: 700px) 100vw, 700px"}}}}}},"pageContext":{"slug":"/posts/decorator-pattern-ciphers/","previous":{"fields":{"slug":"/posts/design-patterns/"},"frontmatter":{"title":"Design patterns"}},"next":null}}
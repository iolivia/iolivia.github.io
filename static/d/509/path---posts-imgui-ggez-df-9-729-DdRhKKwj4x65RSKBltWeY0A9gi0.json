{"data":{"site":{"siteMetadata":{"fullName":"olivia ifrim","settings":{"disqusShortName":"oliviaifrim","disqusEnabled":false},"twitterHandle":"@oliviff"}},"markdownRemark":{"id":"71c6edc6-9c83-5007-aa86-733ee3335973","html":"<p>In this post I'll walk you through how you can create game user interface with imgui and ggez. I spent a lot of time trying to make this work for my game (which you can read more about <a href=\"/posts/24-hours-of-rust-game-dev/\">here</a>) and suffered greatly because of the lack of documentation, so I'm writing this so you don't have to! </p>\n<h2>Packages</h2>\n<p>Let's start with our tech stack, we'll be needing the following packages.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"># Cargo<span class=\"token punctuation\">.</span>toml\n\n<span class=\"token punctuation\">[</span>dependencies<span class=\"token punctuation\">]</span>\nggez <span class=\"token operator\">=</span> <span class=\"token string\">\"0.4.4\"</span>\n\ngfx_core <span class=\"token operator\">=</span> <span class=\"token string\">\"0.8.3\"</span>\ngfx_device_gl <span class=\"token operator\">=</span> <span class=\"token string\">\"0.15.3\"</span>\n\nimgui <span class=\"token operator\">=</span> <span class=\"token string\">\"0.0.22\"</span>\nimgui<span class=\"token operator\">-</span>gfx<span class=\"token operator\">-</span>renderer <span class=\"token operator\">=</span> <span class=\"token string\">\"0.0.22\"</span></code></pre></div>\n<h2>Starting with ggez</h2>\n<p>We are going to start with the ggez <a href=\"https://github.com/ggez/ggez/blob/0.4/examples/super_simple.rs\">super simple example</a> which just draws a circle which is moving from left to write and then we'll add all the imgui bits.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token comment\">// main.rs</span>\n<span class=\"token keyword\">extern</span> <span class=\"token keyword\">crate</span> ggez<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> ggez<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>conf<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> ggez<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>event<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> ggez<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>graphics<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> DrawMode<span class=\"token punctuation\">,</span> Point2<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> ggez<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>Context<span class=\"token punctuation\">,</span> GameResult<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> MainState <span class=\"token punctuation\">{</span>\n    pos_x<span class=\"token punctuation\">:</span> f32<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">impl</span> MainState <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fn</span> <span class=\"token function\">new</span><span class=\"token punctuation\">(</span>_ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> GameResult<span class=\"token operator\">&lt;</span>MainState<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> s <span class=\"token operator\">=</span> MainState <span class=\"token punctuation\">{</span> pos_x<span class=\"token punctuation\">:</span> <span class=\"token number\">0.0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">Ok</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">impl</span> event<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EventHandler <span class=\"token keyword\">for</span> MainState <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fn</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> _ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> GameResult<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>pos_x <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>pos_x <span class=\"token operator\">%</span> <span class=\"token number\">800.0</span> <span class=\"token operator\">+</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">Ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">fn</span> <span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> GameResult<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        graphics<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        graphics<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">circle</span><span class=\"token punctuation\">(</span>\n            ctx<span class=\"token punctuation\">,</span>\n            DrawMode<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Fill<span class=\"token punctuation\">,</span>\n            Point2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>pos_x<span class=\"token punctuation\">,</span> <span class=\"token number\">380.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token number\">100.0</span><span class=\"token punctuation\">,</span>\n            <span class=\"token number\">2.0</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span>?<span class=\"token punctuation\">;</span>\n        graphics<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">present</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">Ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> c <span class=\"token operator\">=</span> conf<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Conf<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> ctx <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> Context<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">load_from_conf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"super_simple\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ggez\"</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> state <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> MainState<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    event<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Adding imgui</h2>\n<p>We are going to wrap all imgui functionality in a separate class which we will then use in our main. So for now, let's define the public interface of our imgui wrapper. </p>\n<p>There are a few pieces of functionality we'll need:</p>\n<ul>\n<li>initializing imgui</li>\n<li>rendering game ui</li>\n<li>\n<p>receiving mouse events</p>\n<ul>\n<li>mouse position</li>\n<li>mouse button up/down</li>\n</ul>\n</li>\n</ul>\n<p>It should look something like this. </p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token comment\">// This ImGuiWrapper will be the class that encapsulates all </span>\n<span class=\"token comment\">// imgui functionality.</span>\n<span class=\"token keyword\">impl</span> ImGuiWrapper <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// This is going to take a ggez context and give us </span>\n  <span class=\"token comment\">// back a fresh instance of the wrapper.</span>\n  <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function\">new</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> Self <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// This is what we will call on every render iteration</span>\n  <span class=\"token comment\">// to render the imgui bits on top of our game.</span>\n  <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// This is how we'll update the mouse position. The UI needs </span>\n  <span class=\"token comment\">// to be aware of the position so it can display a different color</span>\n  <span class=\"token comment\">// when you hover over a button etc.</span>\n  <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function\">update_mouse_pos</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">:</span> i32<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> i32<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// This is how we'll tell imgui a mouse button has been pressed </span>\n  <span class=\"token comment\">// or released. The 3 bools here are counterintuitively actually</span>\n  <span class=\"token comment\">// 1. has the left mouse button been pressed</span>\n  <span class=\"token comment\">// 2. has the right mouse button been pressed</span>\n  <span class=\"token comment\">// 3. has the middle mouse button been pressed</span>\n  <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function\">update_mouse_down</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> pressed<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>bool<span class=\"token punctuation\">,</span> bool<span class=\"token punctuation\">,</span> bool<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// We could also handle mouse wheels for scrolling or</span>\n  <span class=\"token comment\">// key events in a similar fashion, I'm hoping you get</span>\n  <span class=\"token comment\">// the gist.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The implementation of this wrapper is essentially a bunch of boilerplate code to connect the ggez context with imgui. There are a few key parts around getting raw context bits, like the render target and factory, but apart from that it should be code you write (or copy) once and then pretty much forget about. You can see the full implementation <a href=\"https://github.com/iolivia/imgui-ggez-starter/blob/master/src/imgui_wrapper.rs\">here</a> if you'd like to go a bit deeper into the details.</p>\n<p>Something that is worth looking at closer is the render function, since that actually decides what goes on screen.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Update mouse, this will take the mouse state stored</span>\n  <span class=\"token comment\">// in the wrapper and make sure imgui is aware of it.</span>\n  <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">update_mouse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Create new frame using the ggez context window size</span>\n  <span class=\"token keyword\">let</span> w <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">.</span>window_mode<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> h <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">.</span>window_mode<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> frame_size <span class=\"token operator\">=</span> FrameSize <span class=\"token punctuation\">{</span>\n    logical_size<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>w <span class=\"token keyword\">as</span> f64<span class=\"token punctuation\">,</span> h <span class=\"token keyword\">as</span> f64<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    hidpi_factor<span class=\"token punctuation\">:</span> <span class=\"token number\">2.0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> now <span class=\"token operator\">=</span> Instant<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> delta <span class=\"token operator\">=</span> now <span class=\"token operator\">-</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>last_frame<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> delta_s <span class=\"token operator\">=</span> delta<span class=\"token punctuation\">.</span><span class=\"token function\">as_secs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f32 <span class=\"token operator\">+</span> delta<span class=\"token punctuation\">.</span><span class=\"token function\">subsec_nanos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f32 <span class=\"token operator\">/</span> <span class=\"token number\">1_000_000_000.0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>last_frame <span class=\"token operator\">=</span> now<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Create the frame</span>\n  <span class=\"token keyword\">let</span> ui <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>imgui<span class=\"token punctuation\">.</span><span class=\"token function\">frame</span><span class=\"token punctuation\">(</span>frame_size<span class=\"token punctuation\">,</span> delta_s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Various ui things</span>\n  <span class=\"token comment\">// This is where all our windows/menus/popups will go.</span>\n  <span class=\"token comment\">// For now we just have the sample window.</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Window</span>\n    ui<span class=\"token punctuation\">.</span><span class=\"token function\">window</span><span class=\"token punctuation\">(</span><span class=\"token function\">im_str!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello world\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">300.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">600.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ImGuiCond<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>FirstUseEver<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">100.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ImGuiCond<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>FirstUseEver<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token punctuation\">|</span><span class=\"token punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n        ui<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token function\">im_str!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello world!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ui<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token function\">im_str!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"こんにちは世界！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ui<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token function\">im_str!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"This...is...imgui-rs!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ui<span class=\"token punctuation\">.</span><span class=\"token function\">separator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> mouse_pos <span class=\"token operator\">=</span> ui<span class=\"token punctuation\">.</span><span class=\"token function\">imgui</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mouse_pos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ui<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token function\">im_str!</span><span class=\"token punctuation\">(</span>\n          <span class=\"token string\">\"Mouse Position: ({:.1},{:.1})\"</span><span class=\"token punctuation\">,</span>\n          mouse_pos<span class=\"token number\">.0</span><span class=\"token punctuation\">,</span>\n          mouse_pos<span class=\"token number\">.1</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> ui<span class=\"token punctuation\">.</span><span class=\"token function\">small_button</span><span class=\"token punctuation\">(</span><span class=\"token function\">im_str!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"small button\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Small button clicked\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Render</span>\n  <span class=\"token keyword\">let</span> <span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">,</span> encoder<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> graphics<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">get_gfx_objects</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>renderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>ui<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token operator\">*</span>factory<span class=\"token punctuation\">,</span> encoder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Integrating imgui in our main</h2>\n<p>Now that we have a clear interface for how we'll handle imgui, we can extend our main to include this. </p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token comment\">// excluding imports here.</span>\n\n<span class=\"token comment\">// This is our main state, same as before, except</span>\n<span class=\"token comment\">// now we have an instance of imgui_wrapper.</span>\n<span class=\"token keyword\">struct</span> MainState <span class=\"token punctuation\">{</span>\n  pos_x<span class=\"token punctuation\">:</span> f32<span class=\"token punctuation\">,</span>\n  imgui_wrapper<span class=\"token punctuation\">:</span> ImGuiWrapper<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">impl</span> MainState <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">fn</span> <span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">mut</span> ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> GameResult<span class=\"token operator\">&lt;</span>MainState<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Note how we are initializing imgui_wrapper here,</span>\n    <span class=\"token comment\">// we just give it a context and it gives us back</span>\n    <span class=\"token comment\">// an instance which we pass to main state.</span>\n    <span class=\"token keyword\">let</span> imgui_wrapper <span class=\"token operator\">=</span> ImGuiWrapper<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> s <span class=\"token operator\">=</span> MainState <span class=\"token punctuation\">{</span>\n      pos_x<span class=\"token punctuation\">:</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span>\n      imgui_wrapper<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">Ok</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">impl</span> event<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>EventHandler <span class=\"token keyword\">for</span> MainState <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">fn</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> _ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> GameResult<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>pos_x <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>pos_x <span class=\"token operator\">%</span> <span class=\"token number\">800.0</span> <span class=\"token operator\">+</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">Ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">fn</span> <span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> GameResult<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    graphics<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Render game stuff (same as before)</span>\n    <span class=\"token punctuation\">{</span>\n      graphics<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">circle</span><span class=\"token punctuation\">(</span>\n        ctx<span class=\"token punctuation\">,</span>\n        DrawMode<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Fill<span class=\"token punctuation\">,</span>\n        Point2<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>pos_x<span class=\"token punctuation\">,</span> <span class=\"token number\">380.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token number\">100.0</span><span class=\"token punctuation\">,</span>\n        <span class=\"token number\">2.0</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span>?<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Render game ui</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>imgui_wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    graphics<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">present</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">Ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// We subscribe to ggez's mouse motion event to</span>\n  <span class=\"token comment\">// get the position of the mouse and we pretty much</span>\n  <span class=\"token comment\">// just give that to imgui.</span>\n  <span class=\"token keyword\">fn</span> <span class=\"token function\">mouse_motion_event</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span>  _ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> Context<span class=\"token punctuation\">,</span> _state<span class=\"token punctuation\">:</span> MouseState<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">:</span> i32<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> i32<span class=\"token punctuation\">,</span> _xrel<span class=\"token punctuation\">:</span> i32<span class=\"token punctuation\">,</span> _yrel<span class=\"token punctuation\">:</span> i32<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>imgui_wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">update_mouse_pos</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Same for button down events.</span>\n  <span class=\"token keyword\">fn</span> <span class=\"token function\">mouse_button_down_event</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> _ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> Context<span class=\"token punctuation\">,</span> button<span class=\"token punctuation\">:</span> MouseButton<span class=\"token punctuation\">,</span> _x<span class=\"token punctuation\">:</span> i32<span class=\"token punctuation\">,</span> _y<span class=\"token punctuation\">:</span> i32 <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>imgui_wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">update_mouse_down</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>\n      button <span class=\"token operator\">==</span> MouseButton<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Left<span class=\"token punctuation\">,</span>\n      button <span class=\"token operator\">==</span> MouseButton<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Right<span class=\"token punctuation\">,</span>\n      button <span class=\"token operator\">==</span> MouseButton<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Middle<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Same for button up events.</span>\n  <span class=\"token keyword\">fn</span> <span class=\"token function\">mouse_button_up_event</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> _ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> Context<span class=\"token punctuation\">,</span> button<span class=\"token punctuation\">:</span> MouseButton<span class=\"token punctuation\">,</span> _x<span class=\"token punctuation\">:</span> i32<span class=\"token punctuation\">,</span> _y<span class=\"token punctuation\">:</span> i32<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>imgui_wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">update_mouse_down</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">match</span> button <span class=\"token punctuation\">{</span>\n            MouseButton<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Left <span class=\"token operator\">=></span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">,</span>\n            _ <span class=\"token operator\">=></span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">match</span> button <span class=\"token punctuation\">{</span>\n            MouseButton<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Right <span class=\"token operator\">=></span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">,</span>\n            _ <span class=\"token operator\">=></span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">match</span> button <span class=\"token punctuation\">{</span>\n            MouseButton<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Middle <span class=\"token operator\">=></span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">,</span>\n            _ <span class=\"token operator\">=></span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Same as before</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Wrapping up</h2>\n<p>Now that we have imgui integrated into our main, we should see the window we just added drawn on top of our ggez simple circle. </p>\n<p>If we want to get fancy we can add more imgui stuff like popups, a menu bar and some menu items. See it in action below!</p>\n<p><img src=\"/demo-1f07d4aea5415c5fd887c4899142ff5d.gif\" alt=\"alt text\" title=\"Demo\"></p>\n<p>PS: You can find all this code at <a href=\"https://github.com/iolivia/imgui-ggez-starter\">imgui-ggez-starter</a> repo, which should be a pretty good reference point if you want to add imgui to your ggez project. Let me know if you have any problems or you'd like to contribute! </p>","excerpt":"In this post I'll walk you through how you can create game user interface with imgui and ggez. I spent a lot of time trying to make this…","frontmatter":{"title":"Making a basic game UI with imgui and ggez","date":"March 11, 2019","tags":["game dev","rust","imgui","ggez"],"featuredImage":{"childImageSharp":{"sizes":{"src":"/static/74e55e84bcd0b80c1841df39b4393c44/42b2f/demo.png","srcSet":"/static/74e55e84bcd0b80c1841df39b4393c44/7a67c/demo.png 175w,\n/static/74e55e84bcd0b80c1841df39b4393c44/020a7/demo.png 350w,\n/static/74e55e84bcd0b80c1841df39b4393c44/42b2f/demo.png 700w,\n/static/74e55e84bcd0b80c1841df39b4393c44/1e885/demo.png 1050w,\n/static/74e55e84bcd0b80c1841df39b4393c44/bf60b/demo.png 1284w","base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB9ElEQVQ4y5WRz08TQRTH9+9QPCiwLbQ9mVAaI12229JEEiopgm33x2x/GGRlw48QE/EgCFzQC8EEAiZeFLWI2ioYEk7cPHIxISFeuBgTj1Bs8mV22q1NiYRu8sm8mX3vkzdvuJ38Oja3NrH1bRu5/Ffky+TKfNj4hLW37/Fm7R2y6xvs7HPuCyNXg3XG+XofgPfH4RTi4DticPhjpZXuXQEVbkmDJ0gY7qAGl6SeC9cWMSAqk7iVmUE49RSSPoUQXQX5MZySDmegBul8ON9tA8R4CGNsEmRwFErGpAzjjm6iNZhEi0Qo+oXh2iNDUNIG7t0fBklmoKga5EQcPdEYS3AGSF1SztszhIg2BsV8gj5iojsqI9KvItyXRgvtsCT8V2DvXaEU3JTqMyZso8JmvwxekOEQ1aqE5JlkO3bQtcE3gMvtA+A7VTYa+x8TOkTCurGLSg9AKknVcbOgwhNOY3xmCY/mX8JLH/Vah1yRMiEvauUuSBX6mQ6tzjxdaex+34P97f88xI2oiSZBoVK9Vvh/XKEkrvjuYmT6BRMVi0UUCicsfr6axSVvP5tpHcIUm9vE3DKTFE7+4ui4wOKFVx/rF1pYede7B7H346By5V+//0BKTKCxPMcLC61ZWjNq9CuwamYXX+PZShZibBxXbyYqj3IK9UIgYkhVjcQAAAAASUVORK5CYII=","aspectRatio":2.3333333333333335,"sizes":"(max-width: 700px) 100vw, 700px"}}}}}},"pageContext":{"slug":"/posts/imgui-ggez/","previous":{"fields":{"slug":"/posts/entity-component-system-explained/"},"frontmatter":{"title":"Entity component system (ECS) explained with tennis players and courts"}},"next":null}}
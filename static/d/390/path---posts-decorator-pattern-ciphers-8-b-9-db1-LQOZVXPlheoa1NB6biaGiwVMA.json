{"data":{"site":{"siteMetadata":{"fullName":"olivia ifrim","settings":{"disqusShortName":"oliviaifrim","disqusEnabled":false},"twitterHandle":"@oliviff"}},"markdownRemark":{"id":"2f3e65e5-ae43-5892-9ee6-c439db7c63ec","html":"<p>Previously we discussed design patterns briefly and why you might want to use them, so today we'll continue that journey and look into our first design pattern: the decorator pattern. We'll also take a specific example to make sure it's not all abstract garbage. </p>\n<h2>Decorator pattern</h2>\n<p>The decorator pattern is a structural design pattern that allows you to extend the behaviour of an existing class by wrapping it. It's called a decorator because you are decorating the functionality of the initial class.</p>\n<h2>Ciphers</h2>\n<p>Let's take a specific example. </p>\n<p>Let's say we want to implement a few ciphers to encrypt data.</p>\n<h3>Caesar cipher</h3>\n<p>A Caesar cipher is a simple cipher algorithm originating from the Roman times (hence the name) that basically shifts every letter by a given amount to the right, therefore replacing it with a new letter. For example, in a Caesar cipher with an offset of 3, A becomes D, B becomes E, and so on. </p>\n<p>Here are a few examples.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// Caesar cipher 3\n&quot;a&quot; -&gt; &quot;d&quot;\n&quot;A&quot; -&gt; &quot;A&quot;\n&quot;123&quot;, &quot;123&quot;\n&quot;123a&quot;, &quot;123d&quot;\n&quot;abc&quot;, &quot;def&quot;\n\n// Caesar cipher 7\n&quot;a&quot; -&gt; &quot;h&quot;\n&quot;123a&quot;, &quot;123h&quot;\n&quot;abc&quot;, &quot;hij&quot;\n&quot;Hello&quot;, &quot;Olssv&quot;\n&quot;1234&quot;, &quot;1234&quot;\n&quot;Hello world&quot;, &quot;Olssv dvysk&quot;</code></pre></div>\n<p>A few observations about the variant we are going to implement:</p>\n<ul>\n<li>digits are kept as is (note the 123 example)</li>\n<li>symbols are kept as is (note the space in Hello world above)</li>\n<li>case sensitive</li>\n</ul>\n<p>Cool, so let's talk about how we might implement that. We need to receive the plaintext string as an input, along with the offset. Then for every character in the plaintext:</p>\n<ul>\n<li>add it as is if it's a digit or a symbol (in other words, if it's not an alpha character)</li>\n<li>if it's lowercase, shift it by the offset and make sure to stay in the lowercase range</li>\n<li>if it's uppercase, shift it by the offset and make sure to stay in the uppercase range</li>\n</ul>\n<p>The implementation is not too complex, the only tricky bit is making sure to stay in range. Here is the code in rust. </p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function\">decrypt_caesar</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span> offset<span class=\"token punctuation\">:</span> u32<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> encrypted_data <span class=\"token operator\">=</span> String<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> uppercase_start <span class=\"token operator\">=</span> <span class=\"token char string\">'A'</span> <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> lowercase_start <span class=\"token operator\">=</span> <span class=\"token char string\">'a'</span> <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> character <span class=\"token keyword\">in</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">chars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> encrypted_character<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token operator\">!</span>character<span class=\"token punctuation\">.</span><span class=\"token function\">is_alphabetic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        encrypted_data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>character<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> character<span class=\"token punctuation\">.</span><span class=\"token function\">is_uppercase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        encrypted_character <span class=\"token operator\">=</span>\n            <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>character <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> offset <span class=\"token operator\">-</span> uppercase_start<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">26</span> <span class=\"token operator\">+</span> uppercase_start<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        encrypted_character <span class=\"token operator\">=</span>\n            <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>character <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> offset <span class=\"token operator\">-</span> lowercase_start<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">26</span> <span class=\"token operator\">+</span> lowercase_start<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      encrypted_data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>std<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>char<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">from_u32</span><span class=\"token punctuation\">(</span>encrypted_character<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> encrypted_data<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Great, now that we have an implementation let's test it to make sure it works according to the variant rules we've established. </p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token attribute attr-name\">#[test]</span>\n<span class=\"token keyword\">fn</span> <span class=\"token function\">caesar_cypher_7</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> offset <span class=\"token operator\">=</span> <span class=\"token number\">7</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> tests <span class=\"token operator\">=</span> Vec<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"h\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"H\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"abc\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"hij\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pqr\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"wxy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pqrtuv\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"wxyabc\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Olssv\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Helloworld\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Olssvdvysk\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello world\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Olssv dvysk\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1234\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"1234\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1a2v3d4t\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"1h2c3k4a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  tests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"why\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dof\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> test <span class=\"token keyword\">in</span> tests <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">assert_eq!</span><span class=\"token punctuation\">(</span><span class=\"token function\">decrypt</span><span class=\"token punctuation\">(</span>test<span class=\"token number\">.0</span><span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> offset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> test<span class=\"token number\">.1</span><span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Rot13 cipher</h3>\n<p>Another popular cipher is the Rot13 cipher which basically shifts every letter by 13 character. But wait, that sounds kind of familiar. Isn't that like a Caesar cipher, just with an offset of 13? Well that is exactly right. </p>\n<p>Let's implement it (the bad way first).</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function\">decrypt_rot13</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> offset <span class=\"token operator\">=</span> <span class=\"token number\">13</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> encrypted_data <span class=\"token operator\">=</span> String<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> uppercase_start <span class=\"token operator\">=</span> <span class=\"token char string\">'A'</span> <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> lowercase_start <span class=\"token operator\">=</span> <span class=\"token char string\">'a'</span> <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> character <span class=\"token keyword\">in</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">chars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> encrypted_character<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token operator\">!</span>character<span class=\"token punctuation\">.</span><span class=\"token function\">is_alphabetic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        encrypted_data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>character<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> character<span class=\"token punctuation\">.</span><span class=\"token function\">is_uppercase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        encrypted_character <span class=\"token operator\">=</span>\n            <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>character <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> offset <span class=\"token operator\">-</span> uppercase_start<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">26</span> <span class=\"token operator\">+</span> uppercase_start<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        encrypted_character <span class=\"token operator\">=</span>\n            <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>character <span class=\"token keyword\">as</span> u32<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> offset <span class=\"token operator\">-</span> lowercase_start<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">26</span> <span class=\"token operator\">+</span> lowercase_start<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      encrypted_data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>std<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>char<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">from_u32</span><span class=\"token punctuation\">(</span>encrypted_character<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> encrypted_data<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>What is different to the Caesar cipher implementation? Well the one line which hardcodes the offset to 13 and the name of the function. Yeah it's pretty horrible. We are duplicating all the code. Can we reuse it? Let's try. Here is a slightly better version.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function\">decrypt_rot13</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> String <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","excerpt":"Previously we discussed design patterns briefly and why you might want to use them, so today we'll continue that journey and look into ourâ€¦","frontmatter":{"title":"Decorator pattern with ciphers","date":"January 05, 2019","tags":["design patterns","design","decorator pattern"],"featuredImage":{"childImageSharp":{"sizes":{"src":"/static/65c5f5d8af655ae04ffdd988a4417846/5aa81/decorator.jpg","srcSet":"/static/65c5f5d8af655ae04ffdd988a4417846/25db0/decorator.jpg 175w,\n/static/65c5f5d8af655ae04ffdd988a4417846/62b24/decorator.jpg 350w,\n/static/65c5f5d8af655ae04ffdd988a4417846/5aa81/decorator.jpg 700w","base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAD/9oADAMBAAIQAxAAAAHHpJqyYUP/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAXEAEBAQEAAAAAAAAAAAAAAAAAAREQ/9oACAEBAAE/IYi81r//2gAMAwEAAgADAAAAEDQf/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/ELGP/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EJWv/8QAGBABAQEBAQAAAAAAAAAAAAAAAQARITH/2gAIAQEAAT8Q9wMgbDjDye7/2Q==","aspectRatio":2.3333333333333335,"sizes":"(max-width: 700px) 100vw, 700px"}}}}}},"pageContext":{"slug":"/posts/decorator-pattern-ciphers/","previous":{"fields":{"slug":"/posts/design-patterns/"},"frontmatter":{"title":"Design patterns"}},"next":null}}
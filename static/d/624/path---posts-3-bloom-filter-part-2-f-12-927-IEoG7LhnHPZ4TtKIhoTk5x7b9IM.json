{"data":{"site":{"siteMetadata":{"fullName":"olivia ifrim","settings":{"disqusShortName":"oliviaifrim"},"twitterHandle":"@oliviff"}},"markdownRemark":{"id":"640a6364-f38b-5930-8c15-8dc670622713","html":"<p><a href=\"/posts/2-bloom-filter-part-1/\">Last time</a> we talked about what a Bloom filter is and why you might use it. In this post we will cover how Bloom filters work internally and how they achieve constant time lookups. </p>\n<p>We start off with an array of bits of a fixed size <code class=\"language-text\">n</code> (where <code class=\"language-text\">n</code> is dependent on the number of inserts we plan to make) which we initialize to zeroes. We will also need a list of <code class=\"language-text\">k</code> hashing functions. Each hashing function needs to map to an index into our array, so <code class=\"language-text\">0</code> -> <code class=\"language-text\">n-1</code>. It's important we pick uniformly distributed and different hashing functions, and we'll see in a minute why. </p>\n<p>For this example we'll take <code class=\"language-text\">n = 10</code> and <code class=\"language-text\">k = 3</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// Start off with our array of zeroes</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Now, let's see what putting an element does internally.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span> \n\n<span class=\"token comment\">// We take \"A\" and apply all k hashing functions to it</span>\n<span class=\"token function\">k1</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">0</span>\n<span class=\"token function\">k2</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">2</span>\n<span class=\"token function\">k3</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">9</span>\n\n<span class=\"token comment\">// Now we set all those bits to 1</span>\n<span class=\"token comment\">// Note that we read the bits from the left, since we are </span>\n<span class=\"token comment\">// talking about an array of single bits, not bits in a byte.</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Now let's do some queries.</p>\n<p>First let's query for an element which is there. We expect true here.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token function\">isMaybePresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span> \n\n<span class=\"token comment\">// We take \"A\" and apply all k hashing functions to it (again)</span>\n<span class=\"token function\">k1</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">0</span>\n<span class=\"token function\">k2</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">2</span>\n<span class=\"token function\">k3</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">9</span>\n\n<span class=\"token comment\">// Now we check those bits in our array.</span>\n<span class=\"token comment\">// If we have at least one bit which is not set (0), we return false.</span>\n<span class=\"token comment\">// If all bits are set (1), we return true.</span>\n<span class=\"token comment\">// In this case, the bits are set, so we return true.</span>\n<span class=\"token boolean\">true</span></code></pre></div>\n<p>Now let's query for an element which we know is not there. We expect false here <em>most of the time</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token function\">isMaybePresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D\"</span><span class=\"token punctuation\">)</span> \n\n<span class=\"token comment\">// We take \"D\" and apply all k hashing functions to it</span>\n<span class=\"token function\">k1</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">4</span>\n<span class=\"token function\">k2</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">7</span>\n<span class=\"token function\">k3</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">0</span>\n\n<span class=\"token comment\">// In this case</span>\n<span class=\"token comment\">// 4 is not set</span>\n<span class=\"token comment\">// 7 is not set</span>\n<span class=\"token comment\">// 0 is set (it was set by putting \"A\" in)</span>\n<span class=\"token comment\">// So we have at least one bit which is not set, so we return false.</span>\n<span class=\"token boolean\">false</span></code></pre></div>\n<p>OK this makes sense but why can't we say for sure the element is there? When could we query for <code class=\"language-text\">&quot;D&quot;</code> without ever inserting it into the Bloom filter and get true? Let's put another element in.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span> \n\n<span class=\"token comment\">// We take \"B\" and apply all k hashing functions to it</span>\n<span class=\"token function\">k1</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">7</span>\n<span class=\"token function\">k2</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">3</span>\n<span class=\"token function\">k3</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">4</span>\n\n<span class=\"token comment\">// Now we set all those bits to 1</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Now let's query for <code class=\"language-text\">&quot;D&quot;</code> again. </p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token function\">isMaybePresent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D\"</span><span class=\"token punctuation\">)</span> \n\n<span class=\"token comment\">// We take \"D\" and apply all k hashing functions to it</span>\n<span class=\"token function\">k1</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">4</span>\n<span class=\"token function\">k2</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">7</span>\n<span class=\"token function\">k3</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"D\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">0</span>\n\n<span class=\"token comment\">// In this case</span>\n<span class=\"token comment\">// 4 is set (it was set by putting \"B\" in)</span>\n<span class=\"token comment\">// 7 is set (it was set by putting \"B\" in)</span>\n<span class=\"token comment\">// 0 is set (it was set by putting \"A\" in)</span>\n<span class=\"token comment\">// All the bits are now set, so we return true.</span>\n<span class=\"token boolean\">true</span></code></pre></div>\n<p>So the bits corresponding to hashing <code class=\"language-text\">&quot;D&quot;</code> were actually set by putting <code class=\"language-text\">&quot;A&quot;</code> and <code class=\"language-text\">&quot;B&quot;</code> in. This is why we got the false positive. </p>\n<p>This example was deliberately constructed to produce this result, but in reality for a large bloom filter with more hashing functions, the probability of this hapenning is much lower (although it does happen). Tweaking <code class=\"language-text\">n</code> and <code class=\"language-text\">k</code> will produce different false positive rates.</p>\n<p>So let's recap what the logic of the Bloom filter is.</p>\n<p>Putting an element into the Bloom filter</p>\n<ul>\n<li>apply all k hashing functions to input</li>\n<li>set all bits defined by the hashing to 1</li>\n</ul>\n<p>Checking whether an element is present in the Bloom filter</p>\n<ul>\n<li>apply all k hashing functions to input</li>\n<li>if all bits defined by the hashing are set (1) we return true, otherwise we return false</li>\n</ul>\n<p><a href=\"/posts/4-bloom-filter-part-3/\">Next up</a>, we'll look at how to implement this.</p>","excerpt":"Last time  we talked about what a Bloom filter is and why you might use it. In this post we will cover how Bloom filters work internally andâ€¦","frontmatter":{"title":"Implementing a Bloom filter - Part 2","date":"May 23, 2017","tags":["bloom filter","bloom","cpp","c++"],"featuredImage":{"childImageSharp":{"sizes":{"src":"/static/75564edf5f5b9ef511f2982eb72e898e/81388/bloom-flower-2.jpg","base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABcBAAMBAAAAAAAAAAAAAAAAAAECAwT/2gAMAwEAAhADEAAAAanJ1nMYssv/xAAaEAACAgMAAAAAAAAAAAAAAAACIQABMkFC/9oACAEBAAEFAgUu0RPjZ5//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwEn/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAEC/9oACAECAQE/AdI//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAEQEiH/2gAIAQEABj8C1OCjP//EABwQAAICAgMAAAAAAAAAAAAAAAABESFRYaGxwf/aAAgBAQABPyHKSlWiehZhGmzvPByT/9oADAMBAAIAAwAAABAvD//EABcRAAMBAAAAAAAAAAAAAAAAAAABITH/2gAIAQMBAT8QwNU//8QAFxEBAQEBAAAAAAAAAAAAAAAAAREAIf/aAAgBAgEBPxBNtw4b/8QAHRABAAICAgMAAAAAAAAAAAAAAQARITFBsWGh8P/aAAgBAQABPxCzuMijD5gGKrc2TgGNOgzrdw3+bnv5/9k=","aspectRatio":2.3333333333333335,"srcSet":"/static/75564edf5f5b9ef511f2982eb72e898e/cb2d9/bloom-flower-2.jpg 175w,\n/static/75564edf5f5b9ef511f2982eb72e898e/7e73d/bloom-flower-2.jpg 350w,\n/static/75564edf5f5b9ef511f2982eb72e898e/81388/bloom-flower-2.jpg 688w","sizes":"(max-width: 688px) 100vw, 688px"}}}}}},"pageContext":{"slug":"/posts/3-bloom-filter-part-2/","previous":{"fields":{"slug":"/posts/2-bloom-filter-part-1/"},"frontmatter":{"title":"Implementing a Bloom filter - Part 1"}},"next":{"fields":{"slug":"/posts/4-bloom-filter-part-3/"},"frontmatter":{"title":"Implementing a Bloom filter - Part 3"}}}}
{"data":{"site":{"siteMetadata":{"fullName":"olivia ifrim","settings":{"disqusShortName":"oliviaifrim","disqusEnabled":false},"twitterHandle":"@oliviff"}},"markdownRemark":{"id":"2a6442ef-3fb2-5e1a-8b93-f81942c9d4b3","html":"<p>In the last post I talked about a small game I built in Rust and roughly how far I got in 24 hours. One of the biggest challenges I had was finding the right architecture where things would be easy to build and any new feature should have clear steps on what patterns to combine to achive it. I started off with a basic inheritance model until I realized that was The Wrong Thing TM and switched to an Entity component system architecture (or ECS as it's most commonly referred to). I didn't find ECS immediately intuitive and I struggled a bit to think in ECS, so I figured I'd write a short post about my current setup and how I got myself to think more ECS and less in a traditional OOP way.</p>\n<h2>ECS overview</h2>\n<p>So what is ECS? <a href=\"https://en.wikipedia.org/wiki/Entity_component_system\">ECS - Entity Component System</a> is a type of architecture and the gist of it is:</p>\n<ul>\n<li>separate data from logic</li>\n<li>composition over inheritance</li>\n<li>data oriented design</li>\n</ul>\n<p>In ECS terminology you have these 3 basic concepts:</p>\n<ul>\n<li>Entities: this is just a type of a thing referenced with an identifier (like a Player, Ball, etc.)</li>\n<li>Components: these are what your entities are made up of. For example, you can have a Renderable component, a Position component, etc. This is purely data storage.</li>\n<li>Systems: systems use entities and components and contain behaviour and logic based on that data. For example, you could have a rendering system which just iterates through all entities which contain renderable components and draws all of them.</li>\n</ul>\n<p>If it doesn't make sense yet, hang in there because a real example is coming.</p>\n<h2>ECS in practice</h2>\n<p>So let's talk a specific example. If you didn't read my previous post I'll just quickly describe what I was trying to achieve with this game. See it in action below.</p>\n<p><img src=\"/people_to_courts-7b0c8ec951007ad4d5895716c3ca7618.gif\" alt=\"alt text\" title=\"People going to courts\"></p>\n<p>So I wanted a few things:</p>\n<ul>\n<li>a floor, which is pretty much static and doesn't do anything</li>\n<li>people, which are tennis players</li>\n<li>tennis courts</li>\n<li>people should find an available tennis court</li>\n<li>people that have an assigned tennis court should travel to said court</li>\n</ul>\n<p>And here is how that works in ECS terms. Let's start with components.</p>\n<h3>Components</h3>\n<p>So components are basically the simplest smallest piece of data that makes sense on its own (think an atom) and entities are just a composition of a lot of components. So let's try to break this down. </p>\n<p>We need:</p>\n<ol>\n<li>a way to assign an image or a list of images to an entity: for example, the court is made up of 8 images and the person is made up of 1 image</li>\n<li>a way to keep track of where each entity is on the grid</li>\n<li>a way to link a person to a court</li>\n<li>a way to link a court to a person</li>\n</ol>\n<h4>Images</h4>\n<p>For handling images, I decided to break this down into two components (although I'm not entirely convinced now that that was a good idea now), but here is how I thought about it. </p>\n<p><code class=\"language-text\">Image</code> will handle the cases when you only need one image (like the floor and the person)\n<code class=\"language-text\">Sprite</code> will handle the more complex case of a list of images with rotations (like the tennis courts)</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token comment\">// image.rs</span>\n<span class=\"token comment\">// Image doesn't do all that much, just loads</span>\n<span class=\"token comment\">// an image from a path and keeps it so we can </span>\n<span class=\"token comment\">// use it for rendering later.</span>\n<span class=\"token keyword\">use</span> specs<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>VecStorage<span class=\"token punctuation\">;</span>\n\n<span class=\"token attribute attr-name\">#[derive(Debug, Component)]</span>\n<span class=\"token attribute attr-name\">#[storage(VecStorage)]</span>\n<span class=\"token keyword\">pub</span> <span class=\"token keyword\">struct</span> Image <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">pub</span> path<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">impl</span> Image <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function\">new</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>ggez<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Context<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span>str<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> Self <span class=\"token punctuation\">{</span>\n        Image <span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// sprite.rs</span>\n<span class=\"token comment\">// Sprite is a little more complex but </span>\n<span class=\"token comment\">// the idea is simple: multiple images, </span>\n<span class=\"token comment\">// each with an offset and a rotation. </span>\n<span class=\"token keyword\">use</span> ggez<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>graphics<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> specs<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>VecStorage<span class=\"token punctuation\">;</span>\n\n<span class=\"token attribute attr-name\">#[derive(Debug, Clone)]</span>\n<span class=\"token keyword\">pub</span> <span class=\"token keyword\">struct</span> SpriteConfig <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">pub</span> image_index<span class=\"token punctuation\">:</span> usize<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">pub</span> tile_offset_x<span class=\"token punctuation\">:</span> u8<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">pub</span> tile_offset_y<span class=\"token punctuation\">:</span> u8<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">pub</span> rotation<span class=\"token punctuation\">:</span> f32<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">impl</span> SpriteConfig <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function\">new</span><span class=\"token punctuation\">(</span>image_index<span class=\"token punctuation\">:</span> usize<span class=\"token punctuation\">,</span> tile_offset_x<span class=\"token punctuation\">:</span> u8<span class=\"token punctuation\">,</span> tile_offset_y<span class=\"token punctuation\">:</span> u8<span class=\"token punctuation\">,</span> rotation<span class=\"token punctuation\">:</span> f32<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> Self <span class=\"token punctuation\">{</span>\n    SpriteConfig <span class=\"token punctuation\">{</span>\n      image_index<span class=\"token punctuation\">,</span>\n      tile_offset_x<span class=\"token punctuation\">,</span>\n      tile_offset_y<span class=\"token punctuation\">,</span>\n      rotation<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token attribute attr-name\">#[derive(Debug, Component)]</span>\n<span class=\"token attribute attr-name\">#[storage(VecStorage)]</span>\n<span class=\"token keyword\">pub</span> <span class=\"token keyword\">struct</span> Sprite <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">pub</span> images<span class=\"token punctuation\">:</span> Vec<span class=\"token operator\">&lt;</span>graphics<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Image<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">pub</span> config<span class=\"token punctuation\">:</span> Vec<span class=\"token operator\">&lt;</span>SpriteConfig<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">impl</span> Sprite <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function\">new</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> <span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>ggez<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Context<span class=\"token punctuation\">,</span> paths<span class=\"token punctuation\">:</span> Vec<span class=\"token operator\">&lt;</span><span class=\"token operator\">&amp;</span>str<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">:</span> Vec<span class=\"token operator\">&lt;</span>SpriteConfig<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> Self <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> images <span class=\"token operator\">=</span> Vec<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token operator\">&lt;</span>graphics<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Image<span class=\"token operator\">></span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> path <span class=\"token keyword\">in</span> paths <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">let</span> image <span class=\"token operator\">=</span>\n        graphics<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Image<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token function\">format!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Could not load image at {}\"</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      images<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    Sprite <span class=\"token punctuation\">{</span> images<span class=\"token punctuation\">,</span> config <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Entities</h3>\n<h3>Systems</h3>","excerpt":"In the last post I talked about a small game I built in Rust and roughly how far I got in 24 hours. One of the biggest challenges I had was…","frontmatter":{"title":"Entity component system (ECS) explained","date":"March 03, 2019","tags":["game dev","rust","ecs"],"featuredImage":{"childImageSharp":{"sizes":{"src":"/static/4e9862d4e5ea0fe29d70f90fbb6b9d25/5aa81/tennis.jpg","srcSet":"/static/4e9862d4e5ea0fe29d70f90fbb6b9d25/25db0/tennis.jpg 175w,\n/static/4e9862d4e5ea0fe29d70f90fbb6b9d25/62b24/tennis.jpg 350w,\n/static/4e9862d4e5ea0fe29d70f90fbb6b9d25/5aa81/tennis.jpg 700w,\n/static/4e9862d4e5ea0fe29d70f90fbb6b9d25/4935c/tennis.jpg 992w","base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMBAv/EABcBAAMBAAAAAAAAAAAAAAAAAAABAwT/2gAMAwEAAhADEAAAAYuNxzqmH//EABkQAQEAAwEAAAAAAAAAAAAAAAECABEiQf/aAAgBAQABBQL0TZNIOby+b//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AUf/xAAcEAACAQUBAAAAAAAAAAAAAAAAAQIRITJBYVH/2gAIAQEABj8Co8ulkZK3ShFaJJen/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFBUf/aAAgBAQABPyF3lt3gg1QbltkABTgxE22LsFf1XU8JBUT/2gAMAwEAAgADAAAAED8P/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERUaH/2gAIAQIBAT8QmiZq3h//xAAcEAEAAgMAAwAAAAAAAAAAAAABESEAMUFRYaH/2gAIAQEAAT8QHXpqRsUQO5Y2SpREQiXd4sDI0Qgus21e8lh7vLFuV7NPzHoWA4Tn/9k=","aspectRatio":2.3333333333333335,"sizes":"(max-width: 700px) 100vw, 700px"}}}}}},"pageContext":{"slug":"/posts/entity-component-system-explained/","previous":{"fields":{"slug":"/posts/24-hours-of-rust-game-dev/"},"frontmatter":{"title":"24 hours of game development in Rust"}},"next":null}}